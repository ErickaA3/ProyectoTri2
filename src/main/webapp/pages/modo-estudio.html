<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi ProfesorIA - Modo Estudio</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/styles-shared.css">
    <link rel="stylesheet" href="../css/modo-estudio.css">
</head>
<body data-page="modo-estudio">

    <div id="navbar-container"></div>
    <div id="sidebar-container"></div>

    <main class="content">
        <div class="modo-estudio-wrapper">
            <!-- Header -->
            <div class="modo-estudio-header">
                <img src="../images/modo-estudio/modo-estudio-logo.png" alt="Modo Estudio" class="modo-estudio-logo">
            </div>

            <!-- Card Principal -->
            <div class="modo-estudio-card">
                <!-- Chispas doradas -->
                <div class="sparkles-container" id="sparklesContainer"></div>
                
                <!-- Opciones de Estudio -->
                <div class="study-options">
                    <div class="study-option selected" onclick="toggleOption(this)" data-type="esquemas">
                        <div class="study-option-icon">
                            <i class="fas fa-project-diagram"></i>
                        </div>
                        <div class="study-option-label">
                            <div class="study-checkbox">
                                <i class="fas fa-check"></i>
                            </div>
                            Esquemas
                        </div>
                    </div>

                    <div class="study-option selected" onclick="toggleOption(this)" data-type="flashcards">
                        <div class="study-option-icon">
                            <i class="fas fa-layer-group"></i>
                        </div>
                        <div class="study-option-label">
                            <div class="study-checkbox">
                                <i class="fas fa-check"></i>
                            </div>
                            Flashcards
                        </div>
                    </div>

                    <div class="study-option selected" onclick="toggleOption(this)" data-type="quizzes">
                        <div class="study-option-icon">
                            <i class="fas fa-question-circle"></i>
                        </div>
                        <div class="study-option-label">
                            <div class="study-checkbox">
                                <i class="fas fa-check"></i>
                            </div>
                            Quizzes
                        </div>
                    </div>

                    <div class="study-option selected" onclick="toggleOption(this)" data-type="resumenes">
                        <div class="study-option-icon">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="study-option-label">
                            <div class="study-checkbox">
                                <i class="fas fa-check"></i>
                            </div>
                            Resúmenes
                        </div>
                    </div>
                </div>

                <!-- Aportar Datos -->
                <div class="data-section">
                    <div class="data-label">Aportar datos:</div>
                    <div class="data-options">
                        <label class="data-option" id="fileOption" data-type="file">
                            <i class="fas fa-paperclip"></i>
                            Adjuntar archivo
                            <input type="file" id="fileInput" accept=".pdf,.doc,.docx,.txt,.pptx" onchange="handleFileSelect(event)">
                        </label>
                        <div class="data-option" id="textOption" onclick="toggleTextInput()" data-type="text">
                            <i class="fas fa-pen-to-square"></i>
                            Escribir texto
                        </div>
                    </div>

                    <!-- Archivo adjuntado -->
                    <div class="file-attached" id="fileAttached">
                        <i class="fas fa-file-lines"></i>
                        <div class="file-info">
                            <div class="file-name" id="fileName">documento.pdf</div>
                            <div class="file-size" id="fileSize">2.4 MB</div>
                        </div>
                        <button class="file-remove" onclick="removeFile()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <!-- Caja de texto -->
                    <div class="text-input-container" id="textInputContainer">
                        <textarea class="text-input" id="textInput" placeholder="Escribe o pega aquí el contenido que quieres estudiar..."></textarea>
                        <div class="text-input-hint">
                            <span id="charCount">0</span> caracteres
                        </div>
                    </div>
                </div>

                <!-- Botón Generar -->
                <button class="generate-btn" onclick="generateStudySession()" id="generateBtn">
                    <span class="generate-btn-text">Generar</span>
                </button>
            </div>
        </div>
    </main>

    <!-- Toast -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage">Sesión generada</span>
    </div>

    <script src="../js/components.js"></script>

    <script>
        // Estado de la aplicación
        let selectedOptions = ['esquemas', 'flashcards', 'quizzes', 'resumenes'];
        let selectedDataType = null;
        let uploadedFile = null;
        let userText = '';

        // Generar estrellas doradas con glow
        function generateSparkles() {
            const container = document.getElementById('sparklesContainer');
            
            // SVG de estrella de 4 puntas
            const starSVG = '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 0L14.5 9.5L24 12L14.5 14.5L12 24L9.5 14.5L0 12L9.5 9.5L12 0Z" fill="url(#goldGradient)"/><defs><linearGradient id="goldGradient" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#FFF8DC"/><stop offset="30%" style="stop-color:#FFD700"/><stop offset="60%" style="stop-color:#FFC125"/><stop offset="100%" style="stop-color:#FFB347"/></linearGradient></defs></svg>';

            const starPositions = [
                { left: -5, top: -5, size: 'large', delay: 0, anim: 'star-glow' },
                { left: 8, top: 15, size: 'small', delay: 0.8, anim: 'star-twinkle' },
                { left: -2, top: 35, size: 'tiny', delay: 1.5, anim: 'star-glow-alt' },
                { left: 20, top: -8, size: 'small', delay: 0.3, anim: 'star-glow-alt' },
                { left: 75, top: -6, size: 'small', delay: 0.6, anim: 'star-twinkle' },
                { left: 98, top: -8, size: 'large', delay: 0.2, anim: 'star-glow' },
                { left: 92, top: 12, size: 'tiny', delay: 1.2, anim: 'star-glow-alt' },
                { left: 105, top: 25, size: 'small', delay: 0.9, anim: 'star-twinkle' },
                { left: -8, top: 55, size: 'small', delay: 0.4, anim: 'star-glow' },
                { left: 3, top: 75, size: 'tiny', delay: 1.8, anim: 'star-twinkle' },
                { left: 102, top: 50, size: 'small', delay: 0.7, anim: 'star-glow-alt' },
                { left: 95, top: 70, size: 'tiny', delay: 1.1, anim: 'star-glow' },
                { left: -6, top: 95, size: 'large', delay: 0.5, anim: 'star-glow' },
                { left: 10, top: 88, size: 'tiny', delay: 1.6, anim: 'star-twinkle' },
                { left: 5, top: 108, size: 'small', delay: 0.1, anim: 'star-glow-alt' },
                { left: 35, top: 105, size: 'tiny', delay: 1.3, anim: 'star-glow' },
                { left: 65, top: 103, size: 'small', delay: 0.4, anim: 'star-twinkle' },
                { left: 100, top: 92, size: 'large', delay: 0.3, anim: 'star-glow-alt' },
                { left: 88, top: 105, size: 'small', delay: 1.0, anim: 'star-glow' },
                { left: 105, top: 75, size: 'tiny', delay: 1.7, anim: 'star-twinkle' },
            ];

            let sparklesHTML = '';
            starPositions.forEach((pos) => {
                const duration = 2 + Math.random() * 2;
                sparklesHTML += '<div class="star-sparkle ' + pos.size + '" style="left:' + pos.left + '%;top:' + pos.top + '%;animation:' + pos.anim + ' ' + duration + 's ease-in-out infinite;animation-delay:' + pos.delay + 's">' + starSVG + '</div>';
            });
            container.innerHTML = sparklesHTML;
        }

        // Toggle opción de estudio
        function toggleOption(element) {
            element.classList.toggle('selected');
            const type = element.dataset.type;
            
            if (element.classList.contains('selected')) {
                if (!selectedOptions.includes(type)) {
                    selectedOptions.push(type);
                }
            } else {
                selectedOptions = selectedOptions.filter(opt => opt !== type);
            }
            
            updateGenerateButton();
        }

        // Manejar selección de archivo
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                uploadedFile = file;
                selectedDataType = 'file';
                
                document.getElementById('fileOption').classList.add('selected');
                document.getElementById('textOption').classList.remove('selected');
                document.getElementById('textInputContainer').classList.remove('show');
                
                document.getElementById('fileName').textContent = file.name;
                document.getElementById('fileSize').textContent = formatFileSize(file.size);
                document.getElementById('fileAttached').classList.add('show');
                
                showToast('Archivo adjuntado: ' + file.name);
            }
        }

        // Formatear tamaño de archivo
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Remover archivo
        function removeFile() {
            uploadedFile = null;
            selectedDataType = null;
            document.getElementById('fileInput').value = '';
            document.getElementById('fileOption').classList.remove('selected');
            document.getElementById('fileAttached').classList.remove('show');
            showToast('Archivo eliminado');
        }

        // Toggle caja de texto
        function toggleTextInput() {
            const textContainer = document.getElementById('textInputContainer');
            const textOption = document.getElementById('textOption');
            const fileOption = document.getElementById('fileOption');
            
            if (textContainer.classList.contains('show')) {
                textContainer.classList.remove('show');
                textOption.classList.remove('selected');
                selectedDataType = null;
            } else {
                textContainer.classList.add('show');
                textOption.classList.add('selected');
                fileOption.classList.remove('selected');
                document.getElementById('fileAttached').classList.remove('show');
                uploadedFile = null;
                document.getElementById('fileInput').value = '';
                selectedDataType = 'text';
                document.getElementById('textInput').focus();
            }
        }

        // Contador de caracteres
        document.addEventListener('DOMContentLoaded', function() {
            const textInput = document.getElementById('textInput');
            const charCount = document.getElementById('charCount');
            
            textInput.addEventListener('input', function() {
                userText = this.value;
                charCount.textContent = this.value.length.toLocaleString();
            });

            generateSparkles();
        });

        // Actualizar estado del botón
        function updateGenerateButton() {
            const btn = document.getElementById('generateBtn');
            btn.disabled = selectedOptions.length === 0;
        }

        // Generar sesión de estudio
        function generateStudySession() {
            if (selectedOptions.length === 0) {
                showToast('Selecciona al menos una opción');
                return;
            }

            if (selectedDataType === 'text') {
                userText = document.getElementById('textInput').value;
            }

            const session = {
                options: selectedOptions,
                dataType: selectedDataType,
                file: uploadedFile ? uploadedFile.name : null,
                text: userText || null,
                timestamp: new Date().toISOString()
            };

            console.log('Sesión de estudio generada:', session);
            
            const btn = document.getElementById('generateBtn');
            btn.innerHTML = '<div class="loading-spinner"></div> <span class="generate-btn-text">Generando...</span>';
            btn.disabled = true;
            
            setTimeout(() => {
                btn.innerHTML = '<span class="generate-btn-text">Generar</span>';
                btn.disabled = false;
                showToast('¡Sesión lista! Redirigiendo...');
            }, 2500);
        }

        // Mostrar toast
        function showToast(message) {
            const toast = document.getElementById('toast');
            document.getElementById('toastMessage').textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
    </script>
</body>
</html>